name: Generate / Update Swagger API Schema

on:
  push:
    branches:
      - main

jobs:
  generate-or-update-swagger-api-schema:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 7.12.2

      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: 16
          cache: 'pnpm'

      - name: Installing Project Dependencies
        run: pnpm install

      - name: Set Up Environment File
        uses: SpicyPizza/create-envfile@v1.3
        with:
          envkey_BASE_PATH: /api
          envkey_CLUSTERING: false
          envkey_PORT: 3000
          envkey_NODE_ENV: production

      - name: Exporting API JSON
        run: pnpm swagger

      - name: Updating API Documentation
        uses: dmnemec/copy_file_to_another_repo_action@main
        env:
          API_TOKEN_GITHUB: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
        with:
          source_file: 'swagger.json'
          destination_repo: 'kenso312/nestjs-v9-webpack-boilerplate'
          destination_branch: 'docs/swagger'
          destination_folder: '/'
          user_email: 'bot@github.com'
          user_name: 'GitHub Bot'
          commit_messaGitHubcs: 'docs: update Swagger schema'
